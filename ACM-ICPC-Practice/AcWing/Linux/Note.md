## Linux基础课

### 0.1 课程概论

目标：独立开发并上线各种网页或应用

绝大多数后端服务器都是Linux服务器

- Linux常用版本
  - Ubuntu
  - CentOS

实用主义，并不以学全为目的

### 1.1 常用文件管理命令

文件系统

- 根目录：'/'
  - bin：可执行文件
  - etc：配置文件
  - var：日志
    - log
  - lib：安装包、库文件等
  - home：所有用户的家目录
  - proc：进程相关信息

- 路径描述：
  - 绝对路径：从根目录开始描述
  - 相对路径：从当前所在路径开始描述
  - `.` 表示当前目录；`..`表示上一级目录；`-` 表示上一次待过的目录
  - `~` 表示家目录，即当前登录用户的目录

- 常用命令介绍
  - ctrl c: 取消命令，并且换行
  - ctrl u: 清空本行命令
  - tab：可以补全命令和文件名，如果只有一种选项则自动补全，如果补全不了快速按两下tab键，可以显示备选选项
  - ls: 列出当前目录下所有文件，蓝色的是文件夹，白色的是普通文件，绿色的是可执行文件
    - `-l` 查看文件的详细信息：文件权限、文件大小、修改时间等
    - `-*h` 人性化输出，例如 `ls -lh` 将文件大小转化为KB等
    - `-a` 显示所有文件包括隐藏文件
    - `-A` 显示所有文件包括隐藏文件，但不包括当前目录 `.` 和上级目录 `..` 这两个文件
  - pwd: 显示当前路径
  - cd XXX: 进入XXX目录下, cd .. 返回上层目录
    - 不加参数默认返回用户的家目录
  - cp XXX YYY: 将XXX文件复制成YYY（即**复制**粘贴后并重命名为YYY），XXX和YYY可以是一个路径，比如../dir_c/a.txt，表示上层目录下的dir_c文件夹下的文件a.txt
    - `-r` 复制文件夹（目录）时需要添加此参数，将XXX文件夹复制到YYY文件夹下
  - mkdir XXX: 创建目录XXX
    - `-p` 如果所给路径上有目录不存在，则进行创建
  - rm XXX: 删除普通文件，可以跟多个文件，没有回收站
    - `-r`: 删除文件夹
    - `-f`: 删除被保护的文件
  - mv XXX YYY: 将XXX文件移动到YYY（即**剪切**粘贴后并重命名为YYY），和cp命令一样，XXX和YYY可以是一个路径；重命名也是用这个命令
  - touch XXX: 创建一个文件
  - cat XXX: 展示文件XXX中的内容
  - history: 显示历史指令
  - 复制文本
    - windows/Linux下：Ctrl + insert
    - Mac下：command + c
  - 粘贴文本
    - windows/Linux下：Shift + insert
    - Mac下：command + v

### 2.1 tmux和vim

#### tmux教程

功能：
  - 分屏。
  - 允许断开Terminal连接后，继续运行进程。

结构：
  - 一个tmux可以包含多个session（会话），一个session可以包含多个window（窗口），一个window可以包含多个pane（小窗口）。

实例：
  - tmux:
    - session 0:
      - window 0:
        - pane 0
        - pane 1
        - pane 2
        ...
      - window 1
      - window 2
      ...
    - session 1
    - session 2
    ...
    
操作：

1. `tmux`：新建一个session，其中包含一个window，window中包含一个pane，pane里打开了一个shell对话框。
2. `Ctrl + A, %`：将当前pane**左右**平分成两个pane。
3. `Ctrl + A, "`：将当前pane**上下**平分成两个pane。
4. `Ctrl + D`：关闭当前pane；如果当前window的所有pane均已关闭，则自动关闭window；如果当前session的所有window均已关闭，则自动关闭session。
5. 鼠标点击可以选pane。
6. `Ctrl + A, 方向键`：选择相邻的pane。
7. 鼠标拖动pane之间的分割线，可以调整分割线的位置。
8. `Ctrl + A + 方向键`，可以调整pane之间分割线的位置。
9. `Ctrl + A, Z`：将当前pane全屏/取消全屏。
10. `Ctrl + A, D`：挂起当前session。
11. `tmux a` 或 `tmux attach`：打开之前挂起的session。
12. `Ctrl + A, S`：选择其它session。
    - 方向键 —— 上：选择上一项 session/window/pane
    - 方向键 —— 下：选择下一项 session/window/pane
    - 方向键 —— 右：展开当前项 session/window
    - 方向键 —— 左：闭合当前项 session/window
13. `Ctrl + A, C`：在当前session中创建一个新的window。
14. `Ctrl + A, W`：选择其他window，操作方法与(12)完全相同。
15. `Ctrl + A, PageUp`：翻阅当前pane内的内容。
16. 鼠标滚轮：翻阅当前pane内的内容。
17. 在tmux中选中文本时，需要按住shift键。（仅支持Windows和Linux，不支持Mac，不过该操作并不是必须的，因此影响不大）
18. tmux中复制/粘贴文本的通用方式：
    -  `Ctrl + A, [`
    -  用鼠标选中文本，被选中的文本会被自动复制到tmux的剪贴板
    -  `Ctrl + A, ]`，会将剪贴板中的内容粘贴到光标处
    
    
#### vim教程

功能：

- 命令行模式下的文本编辑器。
- 根据文件扩展名自动判别编程语言。支持代码缩进、代码高亮等功能。
- 使用方式：`vim [FILENAME]`
  - 如果已有该文件，则打开它。
  - 如果没有该文件，则打开个一个新的文件，并命名为filename
    
模式：
  - 一般命令模式
    - 默认模式。命令输入方式：类似于打游戏放技能，按不同字符，即可进行不同操作。可以复制、粘贴、删除文本等。
  - 编辑模式
    - 在一般命令模式里按下i，会进入编辑模式。
    - 按下ESC会退出编辑模式，返回到一般命令模式。
  - 命令行模式
    - 在一般命令模式里按下:/?三个字母中的任意一个，会进入命令行模式。命令行在最下面。
    - 可以查找、替换、保存、退出、配置编辑器等。
    
操作：
  1. `i`：进入编辑模式
  2. `ESC`：进入一般命令模式
  3. `h` 或 左箭头键：光标向左移动一个字符
  4. `j` 或 向下箭头：光标向下移动一个字符
  5. `k` 或 向上箭头：光标向上移动一个字符
  6. `l` 或 向右箭头：光标向右移动一个字符
  7. `<n>, <Space>`：n表示数字，按下数字后再按空格，光标会向右移动这一行的n个字符
  8. `0 或 [Home]`：光标移动到本行开头
  9. `$ 或 [End]`：光标移动到本行末尾
  10. `G`：光标移动到最后一行
  11. `:, <n> 或 <n>, G`：n为数字，光标移动到第n行
  12. `gg`：光标移动到第一行，相当于1G
  13. `<n>, <Enter>`：n为数字，光标向下移动n行
  14. `/<word>`：向光标之 **下** 寻找第一个值为word的字符串。
  15. `?<word>`：向光标之 **上** 寻找第一个值为word的字符串。
  16. `n`：重复前一个查找操作（找下一个）
  17. `N`：反向重复前一个查找操作（找上一个）
  18. `:<n1>,<n2>s/<word1>/<word2>/g`：n1与n2为数字，在第n1行与n2行之间所有的word1替换为word2
  19. `:1,$s/<word1>/<word2>/g`：将全文的word1替换为word2，支持正则表达式
  20. `:1,$s/<word1>/<word2>/gc`：将全文的word1替换为word2，且在替换前要求用户确认。
  21. `v`：选中文本，`[ESC][ESC]`：取消选中
  22. `d`：剪切选中的文本
  23. `dd`: 剪切当前行
  24. `y`：复制选中的文本
  25. `yy`: 复制当前行
  26. `p`: 将复制的数据在光标的下一行(yy)/下一个位置(y)粘贴
  27. `u`：撤销
  28. `Ctrl, R`：取消撤销
  29. `>`：将选中的文本整体向右缩进一次
  30. `<`：将选中的文本整体向左缩进一次
  31. `:w` 保存
  32. `:w!` 强制保存
  33. `:q` 退出
  34. `:q!` 强制退出
  35. `:wq` 保存并退出
  36. `:set paste` 设置成粘贴模式，取消代码自动缩进
  37. `:set nopaste` 取消粘贴模式，开启代码自动缩进
  38. `:set nu` 显示行号
  39. `:set nonu` 隐藏行号
  40. `gg=G`：将全文代码格式化，`==`：格式化这一行
  41. `:noh` 关闭查找关键词高亮
  42. `Ctrl + q`：当vim卡死时，可以取消当前正在执行的命令
  
异常处理：
  - 每次用vim编辑文件时，会自动创建一个.filename.swp的临时文件。
  - 如果打开某个文件时，该文件的swp文件已存在，则会报错。此时解决办法有两种：
    - 找到正在打开该文件的程序，并退出
    - 直接删掉该swp文件即可

### Shell语法

#### 概论

通过命令行与操作系统沟通的语言

常用版本：

- Boume Shell(`/bin/sh` 或 `/usr/bin/sh`)
- Boume Again Shell(`/bin/sh`)，这也就是我们常说的Bash
- C Shell(`/usr/bin/csh`)
- K Shell(`/usr/bin/ksh`)
- zsh
...

Bash脚本需要在开头添加以下代码指明所用的解释器

```
#! /bin/bash
```

运行方式：

- 直接通过解释器运行

```
bash test.sh
```

- 作为可执行文件运行

```
chmod +x test.sh // 添加可执行权限
./test.sh        // 当前路径下执行，也可以通过相对路径、绝对路径执行
```
 
#### 注释

- 单行注释

```
# 注释内容
```

- 多行注释

```
:<<EOF
多行注释
EOF
```

`EOF`也可以换成其他字符串

#### 变量

- 定义变量（中间不能有空格）

```
# 以下三种均可定义一个字符串
var1="string"
var2='string'
var3=string
```

- 使用变量

```
echo ${var1}test # 输出结果为stringtest
```

- 只读变量

```
# 方法1
readonly var1 # 将var1声明为只读变量

# 方法2
declare -r var1 # 将var2声明为只读变量
```

- 删除变量

```
unset var1 # 将var1变为空字符串（跟传统意义上的删除不太一样）
echo var1 # 输出空行
```

- 变量类型
  - 自定义变量：子进程不能访问
  - 环境变量：子进程可以访问

```
# 方法1
export var2 # 将var2声明为环境变量
export var4="string" # 声明一个环境变量var4

# 方法2
declare -x var2 # 将var2声明为环境变量
declear +x var4 # 将环境变量var4改为自定义变量
```

- 字符串

  字符串可以不用引号或用单引号、双引号，但有如下区别：
  - 单引号的内容只能原样输出，不能转译、执行、取变量
  - 双引号（或不加引号）的内容可以转译、执行、取变量

  获取字符串长度

```
echo ${#var1} # 输出var1的长度
```

  获取子串（与C++的substr用法相同）

```
echo ${var1:0:5} # 提取var1从0开始的5个字符
```

#### 默认变量

- `$0`：当前执行的路径+文件名
- `$1`：第一个参数
- `$2`：第二个参数（以此类推）

注意，第十个及以上参数需要加上括号，例如`$(10)`

- `$#`：传入的参数个数
- `$*`：用字符串的形式返回所有参数，`"$1 $2 $3 $4"`
- `$@`：用字符串的形式返回所有参数，`"$1" "$2" "$3" "$4"`
- `$$`: 脚本当前运行的进程ID
- `$?`：上一条命令的退出状态 `exit code`（如exit0，exit-1等）,`0`表示正常退出
- `$(command)`：返回 `command` 这条命令的标准输出 `stdout`
- ` `command` `：返回 `command` 这条命令的标准输出 `stdout`（跟上面一样）

#### 数组（类似于JavaScript）

- 定义：

数组中可以存放多个不同类型的值，只支持一维数组，初始化时不需要指明数组的大小

```
array=("1" abc 'string' 2)
```
或者分别赋值（未赋值的部分为空字符串）

```
array[0]=1
array[1]='abc'
array[2]=string
array[3]="2"
```

- 读取整个数组

```
# 方法1
${array[@]} # 采用分别赋值的方式时，未赋值的部分（实际上就没分配空间）会直接跳过

# 方法2
${array[*]}
```

- 数组长度

```
# 方法1
${#array[@]}

# 方法2
${#array[*]}
```

#### `expr`命令（是一个命令，所以所有参数需要用空格隔开）

- 使用方法:

```
expr 表达式
```

- 字符串表达式
  - 长度
```
var="string"

# length STRING 返回STRING的长度
echo $(expr length "$var")

# index STRING CHRASET 返回CHARSET中任意耽搁字符在STRING中最前面的字符位置，下标从1开始计算，若不存在则返回0
echo $(expr index "$var" tes)

# substr STRING POSITON LENGTH 返回STRING中从POSITION开始长度为LENGTH的子串（这里的STRNG下标从1开始计算）
```

- 整数表达式

支持普通的算术操作，算术表达式的优先级低于字符串表达式，高于逻辑关系表达式

```
a=3
b=4
echo $($a + $b)
echo $($a \* $b)
```

需要注意的是，`*`、`(`、`)` 都需要通过反斜杠转义

- 逻辑表达式
  - `|`、`&`：与C/C++类似，存在短路现象
  - `<`、`<=`、`=`、`==`、`!=`、`>=`、`>`：非0为真0为假，且 `=`与`==` 意义完全相同

#### `read` 命令（类似于C++中的cin）

- `-p`：添加提示信息

- `-t`：等待时间，超时则该命令结束，后续的命令仍然正常执行

#### `echo` 命令

- 单引号：原样输出；双引号或不加引号：进行转义及取变量操作，注意：在使用转义符时一定要加双引号，不加引号在 `-e` 参数下也无法使用转义符。

- `-e` 打开转义（使如 `\n`、`\c` 之类的转义符生效）

- 输出重定向

```
echo string > output.txt
```

- `` 会获取命令的标准输出

#### `printf` 命令

- `printf format-string [arguments...]`

#### `test` 命令与判断符号 `[]`

- 逻辑运算符
  - `&&`，`||`：同样存在短路原则，与 `&`、`|` 不同的是，后者是 `expr` 命令中定义的，而这里是bash自带的。
  - 根据短路原则，这两个逻辑运算符还能起到一个if的作用。 
  - 表达式的 `exit code` 为 `0` 时，返回为真

- `test` 命令
  - `test` 命令通过exit code返回结果，0为真，非0为假
  - `expr` 命令通过stdout返回结果，非0为真，0为假
  - `$?` 获取上一条命令的退出状态

- 文件类型判断
  - `-e`：文件是否存在
  - `-f`：是否为文件
  - `-d`：是否为目录

- 文件权限判断
  - `-x`：文件是否可执行
  - `-r`：文件是否可读
  - `-w`：文件是否可写
  - `-s`：是否为非空文件

- 整数间的比较
  - `eq`：等于
  - `ne`：不等于
  - `gt`：大于
  - `lt`：小于
  - `ge`：大于等于
  - `le`：小于等于

- 字符串的比较
  - `-z`：判断string是否为空
  - `-n`：判断string是否非空
  - 字符串之间可以用 `==`、`!=` 判断是否相等

- 多重条件判断
  - `-a`：两条件是否同时成立
  - `-o`：两条件是否至少一个成立
  - `!`：取反

- 判断符号 `[]`
  - 与 `test` 命令的用法几乎一模一样
  - `[[]]` 为加强版，支持更多特性
  - 常用于 `if` 之后

#### 判断语句

- `if ... then`

```
if condition 
then
    command
elif condition
then
    command
else 
    command
fi
```

  - 判断的是condition的exit code，且这里的condition是一个命令，如果需要做条件判断，则可以通过 `test` 或 `[]` 实现

- `case ... esac`

```
case $var in
    1)
        command
        ;;
    2)
        command
        ;;
    *)
        command
        ;;
esac
```

